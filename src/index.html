<!doctype html>

<html lang="en">
    
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>URL Shortener Demo</title>

  <link rel="icon" type="image/png" href="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d5/Rust_programming_language_black_logo.svg/1200px-Rust_programming_language_black_logo.svg.png">

  <style>

    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, Helvetica, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background: #f7f7f9;
    }

    .card {
      background: white;
      padding: 2rem 3rem;
      width: 600px;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.08);
    }

    h1 {
      margin: 0 0 1.2rem 0;
      font-size: 1.6rem;
      color: #111827;
      text-align: center;
    }

    label {
      font-size: 0.9rem;
      color: #374151;
      display: block;
      margin-bottom: 4px;
    }

    input, button {
      width: 100%;
      padding: 12px;
      margin: 8px 0 18px 0;
      font-size: 0.9rem;
      border-radius: 8px;
      line-height: 1.2;
    }

    input {
      border: 1px solid #cbd5e1;
    }

    button {
      background: #2563eb;
      border: none;
      color: white;
      cursor: pointer;
      transition: background 0.2s ease-in-out;
    }

    button:hover {
      background: #1e4fcf;
    }

    .shortened-url {
      margin-top: 1rem;
      padding: 12px;
      background: #eef2ff;
      border-radius: 8px;
      text-align: center;
      font-family: monospace;
    }

    .copy-btn { 
        margin-top: 6px; 
        padding: 6px 12px; 
        font-size: 0.9rem; 
        border-radius: 6px; 
        border: none; 
        cursor: pointer; 
        background: #2563eb; 
        color: white; 
    }
    
    .copy-btn:hover { 
        background: #1e4fcf;
    }

    .error-box {
        background: #ffe6e6;
        color: #b30000;
        border: 1px solid #ff8080;
    }

  </style>

</head>

<body>

<div class="card">

  <h1>URL Shortener with Analytics</h1>

  <form id="shorten-form">

    <label>URL to Shorten:</label>
    <input type="url" name="url" placeholder="https://example.com/rust-project" required>

    <label>Custom Slug (optional):</label>
    <input type="text" name="slug" placeholder="e.g.: link-name">

    <label>Expiration Date (optional):</label>
    <input type="date" name="expires">

    <button type="submit">Generate a Short URL</button>

  </form>

  <div id="shortened-card" style="display:none;" class="shortened-url">

    <a id="short-url-text" href="#" target="_blank"></a>
    <button id="copy-btn" class="copy-btn" onclick="copyUrl()">Copy</button>
    
  </div>

</div>

<script>
    
    const form = document.getElementById("shorten-form");
    const shortenedCard = document.getElementById("shortened-card");
    const shortUrlText = document.getElementById("short-url-text");
    const copyBtn = document.getElementById("copy-btn");

    form.addEventListener("submit", async (e) => {
        e.preventDefault();

        shortenedCard.style.display = "none";
        shortenedCard.classList.remove("error-box");
        copyBtn.style.display = "block"; 

        const formData = new FormData(form);

        const response = await fetch("/shorten", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                url: formData.get("url"),
                slug: formData.get("slug"),
            }),
        });

        const data = await response.json();
        shortenedCard.style.display = "block";

        if (!response.ok) {
            
            //slug already exists
            shortUrlText.textContent = data.error;
            shortUrlText.removeAttribute("href");

            shortenedCard.classList.add("error-box");
            copyBtn.style.display = "none";
            return;

        }

        //slug doesn't exist
        shortUrlText.href = data.short_url;
        shortUrlText.textContent = data.short_url;
        shortenedCard.classList.remove("error-box");
        copyBtn.style.display = "block";

    });

    function copyUrl() {

        const link = shortUrlText.href;
        navigator.clipboard.writeText(link).then(() => {
            alert("Copied to clipboard!");
        });

    }
 
    </script>

</body>

</html>